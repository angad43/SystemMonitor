import { Button, VerticalBox, ScrollView } from "std-widgets.slint";

export struct GpuData {
    name: string,
    usage: string,
    temp: string,
    freq: string,
    vram_total: string,
    vram_used: string,
    wattage: string,
    line_data: string,
    fill_data: string,
}

component StatLabel inherits Text {
    color: #8b9bb4;
    font-size: 14px;
}

component StatValue inherits Text {
    color: #60a5fa;
    font-size: 16px;
    font-weight: 600;
}

export component AppWindow inherits Window {
    width: 1000px;
    height: 800px;
    title: "System Monitor Pro";
    background: #030712;

    // Navigation State
    property <string> active_page: "cpu";
    property <int> active_gpu_index: 0;

    // --- Data Models ---
    in property <[GpuData]> gpus: [];

    // --- CPU Properties ---
    in property <string> processor_name: "Loading...";
    in property <string> cpu_usage: "0%";
    in property <string> cpu_temp: "--Â°C";
    in property <string> cpu_freq: "0.00 GHz";
    in property <string> base_speed: "0.00 GHz";
    in property <string> uptime: "00:00:00";
    in property <int> processes: 0;
    in property <int> cpu_cores: 0;
    in property <int> threads: 0;
    in property <string> usage_line_data: "";
    in property <string> usage_fill_data: "";

    // --- Memory Properties ---
    in property <string> ram_total: "0.00 GB";
    in property <string> ram_free: "0.00 GB";
    in property <string> ram_available: "0.00 GB";
    in property <string> ram_cached: "0.00 GB";
    in property <string> ram_active: "0.00 GB";
    in property <string> swap_total: "0.00 GB";
    in property <string> swap_cache: "0.00 GB";
    in property <string> mem_line_data: "";
    in property <string> mem_fill_data: "";

    HorizontalLayout {
        // --- Sidebar Navigation ---
        Rectangle {
            width: 150px;
            background: #101828;
            // FIXED: Slint doesn't support 'border-right' shorthand
            border-width: 1px;
            border-color: #1e2939;

            VerticalLayout {
                padding: 15px;
                spacing: 12px;
                alignment: start;

                // CPU Button
                Rectangle {
                    height: 50px;
                    border-radius: 8px;
                    background: root.active_page == "cpu" ? #3b82f6 : transparent;
                    Text {
                        text: "CPU";
                        color: #ffffff;
                        font-weight: 700;
                        horizontal-alignment: center;
                    }

                    TouchArea {
                        clicked => {
                            root.active_page = "cpu";
                        }
                    }
                }

                // Memory Button
                Rectangle {
                    height: 50px;
                    border-radius: 8px;
                    background: root.active_page == "memory" ? #3b82f6 : transparent;
                    Text {
                        text: "Memory";
                        color: #ffffff;
                        font-weight: 700;
                        horizontal-alignment: center;
                    }

                    TouchArea {
                        clicked => {
                            root.active_page = "memory";
                        }
                    }
                }

                // Dynamic GPU Buttons
                for gpu[idx] in root.gpus: Rectangle {
                    height: 50px;
                    border-radius: 8px;
                    background: (root.active_page == "gpu" && root.active_gpu_index == idx) ? #f59e0b : transparent;
                    Text {
                        text: root.gpus.length > 1 ? "GPU " + (idx + 1) : "GPU";
                        color: #ffffff;
                        font-weight: 700;
                        horizontal-alignment: center;
                    }

                    TouchArea {
                        clicked => {
                            root.active_page = "gpu";
                            root.active_gpu_index = idx;
                        }
                    }
                }
            }
        }

        // --- Main Content Area ---
        Rectangle {
            // --- CPU PAGE ---
            if (root.active_page == "cpu"): VerticalLayout {
                padding: 40px;
                spacing: 25px;
                Text {
                    text: "CPU Performance";
                    color: #ffffff;
                    font-size: 28px;
                    font-weight: 700;
                }

                Text {
                    text: root.processor_name;
                    color: #7aa2f7;
                    font-size: 18px;
                }

                Rectangle {
                    height: 300px;
                    background: #111827;
                    border-radius: 8px;
                    clip: true;
                    for label[i] in ["100", "75", "50", "25", "0"]: Text {
                        x: 10px;
                        y: i == 0 ? 5px : (i == 4 ? parent.height - 25px : (parent.height / 4) * i - 10px);
                        text: label;
                        color: #4b5563;
                        font-size: 11px;
                    }
                    Rectangle {
                        x: 35px;
                        width: parent.width - 45px;
                        height: parent.height;
                        Path {
                            width: 100%;
                            height: 100%;
                            viewbox-width: 765;
                            viewbox-height: 300;
                            fill: @linear-gradient(180deg, #3b82f644 0%, #3b82f600 100%);
                            commands: root.usage_fill_data;
                        }

                        Path {
                            width: 100%;
                            height: 100%;
                            viewbox-width: 765;
                            viewbox-height: 300;
                            stroke: #3b82f6;
                            stroke-width: 2px;
                            fill: transparent;
                            commands: root.usage_line_data;
                        }
                    }
                }

                HorizontalLayout {
                    spacing: 30px;
                    VerticalLayout {
                        spacing: 20px;
                        width: 350px;
                        HorizontalLayout {
                            spacing: 40px;
                            VerticalLayout {
                                StatLabel {
                                    text: "Current Speed";
                                }

                                StatValue {
                                    text: root.cpu_freq;
                                    font-size: 22px;
                                }
                            }

                            VerticalLayout {
                                StatLabel {
                                    text: "Temperature";
                                }

                                Text {
                                    text: root.cpu_temp;
                                    color: #f87171;
                                    font-size: 22px;
                                    font-weight: 600;
                                }
                            }
                        }

                        VerticalLayout {
                            StatLabel {
                                text: "Processes";
                            }

                            StatValue {
                                text: root.processes;
                                font-size: 22px;
                            }
                        }

                        VerticalLayout {
                            StatLabel {
                                text: "Uptime";
                            }

                            StatValue {
                                text: root.uptime;
                                font-size: 22px;
                            }
                        }
                    }

                    Rectangle {
                        width: 1px;
                        background: #1e2939;
                    }

                    VerticalLayout {
                        spacing: 12px;
                        alignment: center;
                        HorizontalLayout {
                            StatLabel {
                                text: "Usage";
                                width: 120px;
                            }

                            StatValue {
                                text: root.cpu_usage;
                            }
                        }

                        HorizontalLayout {
                            StatLabel {
                                text: "Cores";
                                width: 120px;
                            }

                            StatValue {
                                text: root.cpu_cores;
                            }
                        }

                        HorizontalLayout {
                            StatLabel {
                                text: "Threads";
                                width: 120px;
                            }

                            StatValue {
                                text: root.threads;
                            }
                        }

                        HorizontalLayout {
                            StatLabel {
                                text: "Base Speed";
                                width: 120px;
                            }

                            StatValue {
                                text: root.base_speed;
                            }
                        }
                    }
                }
            }

            // --- MEMORY PAGE ---
            if (root.active_page == "memory"): VerticalLayout {
                padding: 40px;
                spacing: 25px;
                Text {
                    text: "Memory Performance";
                    color: #ffffff;
                    font-size: 28px;
                    font-weight: 700;
                }

                Rectangle {
                    height: 300px;
                    background: #111827;
                    border-radius: 8px;
                    clip: true;
                    Rectangle {
                        x: 35px;
                        width: parent.width - 45px;
                        height: parent.height;
                        Path {
                            width: 100%;
                            height: 100%;
                            viewbox-width: 765;
                            viewbox-height: 300;
                            fill: @linear-gradient(180deg, #10b98144 0%, #10b98100 100%);
                            commands: root.mem_fill_data;
                        }

                        Path {
                            width: 100%;
                            height: 100%;
                            viewbox-width: 765;
                            viewbox-height: 300;
                            stroke: #10b981;
                            stroke-width: 2px;
                            fill: transparent;
                            commands: root.mem_line_data;
                        }
                    }
                }

                HorizontalLayout {
                    spacing: 40px;
                    VerticalLayout {
                        spacing: 12px;
                        width: 300px;
                        Text {
                            text: "RAM";
                            color: #7aa2f7;
                            font-size: 20px;
                            font-weight: 700;
                        }

                        HorizontalLayout {
                            StatLabel {
                                text: "Total";
                                width: 120px;
                            }

                            StatValue {
                                text: root.ram_total;
                            }
                        }

                        HorizontalLayout {
                            StatLabel {
                                text: "Used";
                                width: 120px;
                            }

                            StatValue {
                                text: root.ram_active;
                            }
                        }

                        HorizontalLayout {
                            StatLabel {
                                text: "Free";
                                width: 120px;
                            }

                            StatValue {
                                text: root.ram_free;
                            }
                        }

                        HorizontalLayout {
                            StatLabel {
                                text: "Available";
                                width: 120px;
                            }

                            StatValue {
                                text: root.ram_available;
                            }
                        }
                    }

                    Rectangle {
                        width: 1px;
                        background: #1e2939;
                    }

                    VerticalLayout {
                        spacing: 12px;
                        alignment: start;
                        Text {
                            text: "Swap";
                            color: #7aa2f7;
                            font-size: 20px;
                            font-weight: 700;
                        }

                        HorizontalLayout {
                            StatLabel {
                                text: "Total";
                                width: 120px;
                            }

                            StatValue {
                                text: root.swap_total;
                            }
                        }

                        HorizontalLayout {
                            StatLabel {
                                text: "Used";
                                width: 120px;
                            }

                            StatValue {
                                text: root.swap_cache;
                            }
                        }
                    }
                }
            }

            // --- GPU PAGE ---
            if (root.active_page == "gpu" && root.gpus.length > 0): VerticalLayout {
                padding: 40px;
                spacing: 25px;
                Text {
                    text: "GPU Performance";
                    color: #ffffff;
                    font-size: 28px;
                    font-weight: 700;
                }

                Text {
                    text: root.gpus[root.active_gpu_index].name;
                    color: #7aa2f7;
                    font-size: 18px;
                }

                Rectangle {
                    height: 300px;
                    background: #111827;
                    border-radius: 8px;
                    clip: true;
                    Rectangle {
                        x: 35px;
                        width: parent.width - 45px;
                        height: parent.height;
                        Path {
                            width: 100%;
                            height: 100%;
                            viewbox-width: 765;
                            viewbox-height: 300;
                            fill: @linear-gradient(180deg, #f59e0b44 0%, #f59e0b00 100%);
                            commands: root.gpus[root.active_gpu_index].fill_data;
                        }

                        Path {
                            width: 100%;
                            height: 100%;
                            viewbox-width: 765;
                            viewbox-height: 300;
                            stroke: #f59e0b;
                            stroke-width: 2px;
                            fill: transparent;
                            commands: root.gpus[root.active_gpu_index].line_data;
                        }
                    }
                }

                HorizontalLayout {
                    spacing: 30px;
                    VerticalLayout {
                        spacing: 20px;
                        width: 350px;
                        HorizontalLayout {
                            spacing: 40px;
                            VerticalLayout {
                                StatLabel {
                                    text: "Clock Speed";
                                }

                                StatValue {
                                    text: root.gpus[root.active_gpu_index].freq;
                                    font-size: 22px;
                                }
                            }

                            VerticalLayout {
                                StatLabel {
                                    text: "Temperature";
                                }

                                Text {
                                    text: root.gpus[root.active_gpu_index].temp;
                                    color: #f87171;
                                    font-size: 22px;
                                    font-weight: 600;
                                }
                            }
                        }
                    }

                    Rectangle {
                        width: 1px;
                        background: #1e2939;
                    }

                    VerticalLayout {
                        spacing: 12px;
                        alignment: center;
                        HorizontalLayout {
                            StatLabel {
                                text: "Utilization";
                                width: 120px;
                            }

                            StatValue {
                                text: root.gpus[root.active_gpu_index].usage;
                            }
                        }

                        HorizontalLayout {
                            StatLabel {
                                text: "VRAM Used";
                                width: 120px;
                            }

                            StatValue {
                                text: root.gpus[root.active_gpu_index].vram_used;
                            }
                        }
                    }
                }
            }
        }
    }
}
